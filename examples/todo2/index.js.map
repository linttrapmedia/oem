{
  "version": 3,
  "sources": ["../../src/state/State.ts", "../../src/template/HTML.ts", "src/index.ts"],
  "sourcesContent": [
    "import { StateType } from '../types';\n\ntype Persistence = {\n  key: string;\n  storage: Storage;\n  overwrite?: boolean;\n};\n\nfunction getPersistedVal<T>(param: T, persistence?: Persistence): T {\n  if (!persistence) return param;\n  const storageParam: any = persistence.storage.getItem(persistence.key);\n  const parsedStorageParam = JSON.parse(storageParam);\n  const isStorageParamValid = parsedStorageParam !== null && parsedStorageParam !== undefined;\n  if ((persistence.overwrite ?? true) && isStorageParamValid) return parsedStorageParam;\n  if (!(persistence.overwrite ?? true) && isStorageParamValid) {\n    if (Array.isArray(param) && Array.isArray(parsedStorageParam)) {\n      return [...param, ...parsedStorageParam] as any;\n    } else if (typeof param === 'object' && typeof parsedStorageParam === 'object') {\n      return { ...param, ...parsedStorageParam };\n    }\n  }\n  return param;\n}\n\nexport function State<T>(param: T, persistence?: Persistence): StateType<T> {\n  let _val: T = getPersistedVal(param, persistence);\n  const _subs: ((param: T) => any)[] = [];\n  const val = (): T => _val;\n\n  const _set = (atom: T) => {\n    _val = atom;\n    _subs.forEach((i) => i(atom));\n    if (persistence) persistence.storage.setItem(persistence.key, JSON.stringify(atom));\n  };\n  const $set = (atom: T) => () => _set(atom);\n\n  const reduce = (cb: (prev: T) => T) => _set(cb(_val));\n  const $reduce = (cb: (prev: T) => T) => () => _set(cb(val()));\n\n  const _sub = (cb: (val: T) => any) => {\n    if (!_subs.includes(cb)) _subs.push(cb);\n  };\n\n  const test = (predicate: RegExp | T | ((atom: T) => boolean), truthCheck: true | false = true) => {\n    const serialized_currentVal = JSON.stringify(_val);\n    if (predicate instanceof RegExp) {\n      const result = predicate.test(serialized_currentVal);\n      return truthCheck ? result : !result;\n    } else if (typeof predicate === 'function' && predicate instanceof Function) {\n      const result = (predicate as (atom: T) => boolean)(_val);\n      return truthCheck ? result : !result;\n    } else {\n      const string_comparison = JSON.stringify(predicate);\n      const result = serialized_currentVal === string_comparison;\n      return truthCheck ? result : !result;\n    }\n  };\n\n  const $test =\n    (predicate: RegExp | T | ((atom: T) => boolean), truthCheck: true | false = true) =>\n    () => {\n      const serialized_currentVal = JSON.stringify(_val);\n      if (predicate instanceof RegExp) {\n        const result = predicate.test(serialized_currentVal);\n        return truthCheck ? result : !result;\n      } else if (typeof predicate === 'function' && predicate instanceof Function) {\n        const result = (predicate as (atom: T) => boolean)(_val);\n        return truthCheck ? result : !result;\n      } else {\n        const string_comparison = JSON.stringify(predicate);\n        const result = serialized_currentVal === string_comparison;\n        return truthCheck ? result : !result;\n      }\n    };\n\n  const _unsub = (cb: (val: T) => any) => _subs.splice(_subs.indexOf(cb), 1);\n\n  return {\n    reduce: reduce,\n    set: _set,\n    sub: _sub,\n    test: test,\n    unsub: _unsub,\n    val: val,\n    $reduce: $reduce,\n    $set: $set,\n    $test: $test,\n  };\n}\n",
    "import { HtmlReturnType } from '../types';\n\nfunction CreateEl(tag: string, config: any) {\n  return (...props: any[]) => {\n    const ns = 'http://www.w3.org/1999/xhtml';\n    const el = document.createElementNS(ns, tag as string);\n    return HtmlTag(el, props, config);\n  };\n}\n\nfunction HtmlTag(el: HTMLElement, traits: any[] = [], config: any = {}) {\n  traits.forEach(([trait, ...args]) => config[trait](el, ...args));\n  function fn(...children: any[]) {\n    children.forEach((child) => {\n      if (child) el.append(child);\n    });\n    return el;\n  }\n  return fn;\n}\n\nexport function HTML<P extends Record<string, any>>(config?: P) {\n  return new Proxy(\n    {},\n    {\n      get: (_, prop) => CreateEl(prop as string, config),\n    },\n  ) as HtmlReturnType<P>;\n}\n",
    "import { HTML, State, StateType } from '@/index';\n\nfunction Attr(\n  el: HTMLElement,\n  attr: string,\n  val: string | (() => string) | number | (() => number),\n  condition: boolean | (() => boolean) = true,\n  ...states: StateType<any>[]\n) {\n  const apply = () => {\n    const cond = typeof condition === 'function' ? condition() : condition;\n    const value = typeof val === 'function' ? val() : val;\n    const isDifferent = el.getAttribute(attr) !== value;\n    if (cond && isDifferent) el.setAttribute(attr, String(value));\n  };\n  states.forEach((state) => state.sub(apply));\n  apply();\n}\n\nfunction InnerHTML(\n  el: HTMLElement,\n  content: HTMLElement | (() => HTMLElement),\n  condition: boolean | (() => boolean) = true,\n  ...states: StateType<any>[]\n) {\n  const apply = () => {\n    const cond = typeof condition === 'function' ? condition() : condition;\n    const cont = typeof content === 'function' ? content() : content;\n    const isDifferent = el.innerHTML !== cont.outerHTML;\n    if (cond && isDifferent) {\n      el.innerHTML = '';\n      el.appendChild(cont);\n    }\n  };\n  states.forEach((state) => state.sub(apply));\n  apply();\n}\n\nfunction EventListener(el: HTMLElement, event: string, handler: (e: Event) => void) {\n  el.addEventListener(event, handler);\n}\n\nfunction Map(\n  el: HTMLElement,\n  items: () => any[],\n  renderItem: (item: any) => HTMLElement,\n  condition: boolean | (() => boolean) = true,\n  ...states: StateType<any>[]\n) {\n  const apply = () => {\n    const cond = typeof condition === 'function' ? condition() : condition;\n    if (!cond) return;\n    items().forEach((item) => {\n      const itemEl = renderItem(item);\n      const currEl = el.querySelector(`[key=\"${itemEl.getAttribute('key')}\"]`);\n      const isDiff = itemEl.outerHTML !== currEl?.outerHTML;\n      if (!currEl) return el.appendChild(itemEl);\n      if (currEl && isDiff) el.replaceChild(itemEl, currEl);\n    });\n  };\n  states.forEach((state) => state.sub(apply));\n  apply();\n}\n\nconst tmpl = HTML({\n  event: EventListener,\n  attr: Attr,\n  html: InnerHTML,\n  map: Map,\n});\n\ntype Todo = {\n  id: number;\n  title: string;\n  completed: boolean;\n};\n\nconst todos = State<Todo[]>(\n  [\n    { id: 1, title: 'Learn TypeScript', completed: true },\n    { id: 2, title: 'Build a Todo App', completed: false },\n    { id: 3, title: 'Profit!', completed: false },\n  ],\n  {\n    key: 'todos',\n    storage: localStorage,\n  },\n);\n\nconst updateTodo = (list: Todo[], id: Todo['id'], changes: Partial<Todo>): Todo[] =>\n  list.map((item) => (item.id === id ? { ...item, ...changes } : item));\n\nconst renderTodoItem = (todo: Todo) =>\n  tmpl.li(\n    ['attr', 'id', todo.id],\n    ['attr', 'key', todo.id],\n    ['event', 'click', todos.$reduce((list) => updateTodo(list, todo.id, { completed: !todo.completed }))],\n  )(todo.completed ? '✓ ' : '✗ ', todo.title);\n\ndocument.addEventListener('DOMContentLoaded', () => {\n  const root = document.getElementById('root')!;\n  root.appendChild(tmpl.ul(['map', todos.val, renderTodoItem, true, todos])());\n});\n"
  ],
  "mappings": "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",
  "debugId": "75EA94ACB84C5B1364756E2164756E21",
  "names": []
}